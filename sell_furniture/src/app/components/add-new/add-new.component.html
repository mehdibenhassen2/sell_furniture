<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>

<!-- Add Item Form -->
<div class="add-item-form">
  <h2><i class="fas fa-plus-circle"></i> Add New Item</h2>

  <form [formGroup]="itemForm" (ngSubmit)="addItem()">
    <!-- Title -->
    <div class="form-group">
      <label for="title">Title</label>
      <input
        id="title"
        type="text"
        formControlName="title"
        placeholder="Item title" />
    </div>

    <!-- Description -->
    <div class="form-group">
      <label for="description">Description</label>
      <textarea
        id="description"
        formControlName="description"
        placeholder="Item description"></textarea>
    </div>

    <!-- Price -->
    <div class="form-group">
      <label for="price">Price</label>
      <input
        id="price"
        type="number"
        formControlName="price"
        placeholder="Price in $" />
    </div>

    <!-- Category -->
    <div class="form-group">
      <label for="category">Category</label>
      <select id="category" formControlName="category">
        <option *ngFor="let category of categories" [value]="category">
          {{ category }}
        </option>
      </select>
    </div>

    <!-- Retail -->
    <div class="form-group">
      <label for="retail">Retail Price</label>
      <input
        id="retail"
        type="number"
        formControlName="retail"
        placeholder="Retail price in $" />
    </div>

    <!-- Condition -->
    <div class="form-group">
      <label for="condition">Condition</label>
      <select id="condition" formControlName="condition">
        <option value="Completely New">Completely New</option>
        <option value="Like New">Like New</option>
        <option value="Good">Good</option>
        <option value="Fair">Fair</option>
      </select>
    </div>

    <!-- Instructions -->
    <div class="form-group">
      <label for="instructions">Instructions</label>
      <textarea
        id="instructions"
        formControlName="instructions"
        placeholder="Special instructions"></textarea>
    </div>

    <!-- Images (Drag & Drop + Local Select) -->
    <div
      class="form-group dropzone"
      (drop)="onFileDrop($event)"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
    >
      <p>Drag & drop images here or click to upload</p>
      <input
        type="file"
        multiple
        accept="image/*"
        (change)="onFileSelect($event)"
        hidden
        #fileInput />
      <button type="button" (click)="fileInput.click()">Select Images</button>
    </div>

    <!-- OR Cloudinary Upload -->
    <div class="form-group">
      <p>Or choose from Cloudinary</p>
      <button type="button" class="cloud-btn" (click)="openCloudinaryWidget()">
        <i class="fas fa-cloud-upload-alt"></i> Upload from Cloudinary
      </button>
    </div>

    <!-- Preview -->
    <div class="image-preview" *ngIf="images.length > 0 || uploadedImages.length > 0">
      <div class="preview-box" *ngFor="let img of images; let i = index">
        <img [src]="img" alt="preview" />
        <button type="button" (click)="removeImage(i)">×</button>
      </div>

      <div class="preview-box" *ngFor="let cImg of uploadedImages; let j = index">
        <img [src]="cImg" alt="cloudinary-preview" />
        <button type="button" (click)="removeCloudImage(j)">×</button>
      </div>
    </div>

    <!-- Availability -->
    <div class="form-group checkbox">
      <label>
        <input type="checkbox" formControlName="available" />
        Available
      </label>
    </div>

    <!-- Submit -->
    <button
      type="submit"
      class="primary-btn"
      [disabled]="itemForm.invalid || loading">
      <i class="fas fa-save"></i>
      {{ loading ? 'Saving...' : 'Save Item' }}
    </button>
  </form>
</div>
